{% extends "layout.html" %}

{% block head %}
<title>initsearh</title>
<link href="static/css/index.css" rel="stylesheet" type="text/css" />
<script src="static/node_modules/jquery/dist/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<meta charset="utf-8">
{% endblock %}

<script type="text/javascript">
    var test;
    function onload() {
        test = document.getElementById('search');
    }
    function clickedAllData() {
        location.href = 'http://data.avert.ie/values/!http://rdfs.org/sioc/ns%23container_of///';
    }
</script>

{% block main %}
<!-- <div class="container-fluid">
    <div class="row">
        <div class="col-sm-8">
            <form action="{% url 'gengraph' %}" method="POST">
                {% csrf_token %}
                <label for="patientid">Get Patient:</label>
                <input type="text" name="patientid" id="patientid">
                <button type="submit" class="btn btn-primary btn-sm">Go</button>
            </form>
        </div>
        <div class="col-sm-4">
            <form action="/">
                <link rel="stylesheet"
                href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
                <button type="submit" onclick="" style="float: right" class="btn"><i class="fa fa-home"></i>
                    Home</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col" style="background-color: aliceblue;">
            <div class="table-responsive" style="table-layout: auto; width: 20vw">
                <table id="classes" class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Classes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if classes %}
                        {% for class in classes %}
                        <tr ondragover="allowDrop(event)" ondrop="drop(event)">
                            <form action="/nodegraph" method="POST">
                                <td>
                                    <div draggable="true" ondragstart="drag(event)" class="classname" id="{{ class }}">
                                        {{ class }}</div>
                                </td>
                            </form>
                        </tr>
                        {% endfor %}
                        {% endif %}
                    </tbody>
                </table>
                <table id="header-fixed" class="table table-striped table-hover"></table>
            </div>
            <div class="col-6" ondragover="allowDrop(event)" ondrop="drop(event)"
                style="display: inline-block; background-color: azure;" class="dropzone">
                 <svg xmlns="http://www.w3.org/2000/svg" style="position:absolute; " preserveAspectRatio="false"></svg>
            </div>
            <div class="col" style="background-color:aliceblue;">
                <p> FILTER </p>
            </div>
        </div>
    </div>
</div> -->
<div id="boxes">
    <div id="leftbox" style="background-color: aliceblue;">
        <form action="{% url 'gengraph' %}" method="POST">
            {% csrf_token %}
            <label for="patientid">Get Patient:</label>
            <input type="text" name="patientid" id="patientid">
            <button type="submit" class="btn btn-primary btn-sm">Go</button>
        </form>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" rel="stylesheet" />
        <div class="table-responsive">
            <table id="classes" class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Classes</th>
                    </tr>
                </thead>
                <tbody>
                    {% if classes %}
                    {% for class in classes %}
                    <tr ondragover="allowDrop(event)" ondrop="drop(event)">
                        <form action="/nodegraph" method="POST">
                            <td>
                                <div draggable="true" ondragstart="drag(event)" class="classname" id="{{ class }}">
                                    {{ class }}</div>
                            </td>
                        </form>
                    </tr>
                    {% endfor %}
                    {% endif %}
                </tbody>
            </table>
            <table id="header-fixed" class="table table-striped table-hover"></table>
        </div>
    </div>

    <div ondragover="allowDrop(event)" ondrop="drop(event)" id="middlebox"
        style="display: inline-block; background-color: azure;" class="dropzone">
        <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none"></svg>
    </div>

    <!-- <div style="width:55%; float:left; background-color: beige;">
            <svg xmlns="http://www.w3.org/2000/svg" style="position:absolute; " preserveAspectRatio="none"></svg>
        </div> -->

    <div id="rightbox" style="background-color:aliceblue;">
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <form action="/">
            <button type="submit" onclick="" style="float: right" class="btn"><i class="fa fa-home"></i>
                Home</button>
        </form>
        <p> FILTER </p>
    </div>
</div>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
    var nodes = [
        { id: "mammal", group: 0, label: "Mammals", level: 1 },
        { id: "dog", group: 0, label: "Dogs", level: 2 },
        { id: "cat", group: 0, label: "Cats", level: 2 },
        { id: "fox", group: 0, label: "Foxes", level: 2 },
        { id: "elk", group: 0, label: "Elk", level: 2 },
        { id: "insect", group: 1, label: "Insects", level: 1 },
        { id: "ant", group: 1, label: "Ants", level: 2 },
        { id: "bee", group: 1, label: "Bees", level: 2 },
        { id: "fish", group: 2, label: "Fish", level: 1 },
        { id: "carp", group: 2, label: "Carp", level: 2 },
        { id: "pike", group: 2, label: "Pikes", level: 2 }
    ]

    var height = $("#middlebox").height();
    var width = $("#middlebox").width();


    console.log(height);

    var svg = d3.select('svg')
    svg.attr('width', width).attr('height', height)

    // simulation setup with all forces
    var simulation = d3
        .forceSimulation()
        .force('charge', d3.forceManyBody().strength(-120))
        .force('center', d3.forceCenter(width / 2, height / 2))


    function getNodeColor(node) {
        return node.level === 1 ? 'red' : 'gray'
    }

    var nodeElements = svg.append("g")
        .attr("class", "nodes")
        .selectAll("circle")
        .data(nodes)
        .enter().append("circle")
        .attr("r", 10)
        .attr("fill", getNodeColor)

    var textElements = svg.append("g")
        .attr("class", "texts")
        .selectAll("text")
        .data(nodes)
        .enter().append("text")
        .text(function (node) { return node.label })
        .attr("font-size", 15)
        .attr("dx", 15)
        .attr("dy", 4)

    simulation.nodes(nodes).on('tick', () => {
        nodeElements
            .attr('cx', function (node) { return node.x })
            .attr('cy', function (node) { return node.y })
        textElements
            .attr('x', function (node) { return node.x })
            .attr('y', function (node) { return node.y })
    })

</script>

<script>
    function drag(ev) {
        ev.dataTransfer.setData("text", ev.target.id);
    }

    function drop(ev) {
        ev.preventDefault();
        var data = ev.dataTransfer.getData("text");
        addNode(data);
        ev.target.appendChild(document.getElementById(data));
    }

    function allowDrop(ev) {
        ev.preventDefault();
    }

    var nodes = {};

    function addNode(val) {
        if (nodes[val] == null) {
            nodes[val] = "true";
        } else if (nodes[val] == "true") {
            nodes[val] = "false";
        } else if (nodes[val] == "false") {
            nodes[val] = "true";
        }
        console.log(nodes)
    }
</script>
{% endblock %}